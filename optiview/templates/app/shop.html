{% extends 'app/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/css/shop.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4">

    <!-- Page Title -->
    <h2 class="text-center mb-4">üõç Shop Goggles</h2>

    <!-- CATEGORY FILTER -->
    <div class="d-flex justify-content-center gap-2 mb-4 flex-wrap">
        <a href="{% url 'shop' %}" class="btn btn-outline-dark">All</a>
        {% for cat in categories %}
            <a href="?category={{ cat.name }}" class="btn btn-outline-dark">{{ cat.name }}</a>
        {% endfor %}
    </div>

    <!-- PRODUCTS GRID -->
    <div class="product-grid">
        {% for product in products %}
        <div class="product-card">

            <!-- PRODUCT IMAGE -->
            <a href="{% url 'product_detail' product.id %}" class="product-image">
                <img src="{{ product.image.url|default:'/static/app/images/default.png' }}" alt="{{ product.name }}">
            </a>

            <!-- PRODUCT INFO -->
            <div class="product-body">
                
                <!-- Rating -->
                <div class="product-rating">
                    <span class="rating">{{ product.rating|default:4.5 }} ‚òÖ</span>
                    <span class="reviews">({{ product.review_count|default:100 }})</span>
                </div>

                <!-- Brand -->
                <div class="product-brand">{{ product.brand|default:"Brand Name" }}</div>

                <!-- Product Name -->
                <h5 class="product-name">{{ product.name }}</h5>

                <!-- Price -->
                <div class="price-row">
                    {% if product.discount_price %}
                        <span class="discounted-price">‚Çπ{{ product.discount_price|floatformat:0 }}</span>
                        <span class="original-price">‚Çπ{{ product.price|floatformat:0 }}</span>
                        <span class="discount-percentage">({{ product.discount_percentage }}% OFF)</span>
                    {% else %}
                        <span class="discounted-price">‚Çπ{{ product.price|floatformat:0 }}</span>
                    {% endif %}
                </div>

                <!-- Actions -->
                <div class="card-actions d-flex gap-2 mt-2">
                    {% if product.stock > 0 %}
                        <a href="{% url 'add_to_cart' product.id %}" class="btn btn-primary btn-sm">Add to Cart</a>
                    {% else %}
                        <button class="btn btn-secondary btn-sm" disabled>Out of Stock</button>
                    {% endif %}
                    <a href="{% url 'toggle_wishlist' product.id %}" class="btn btn-outline-danger btn-sm">
                        {% if product.id in wishlist_ids %}
                            <i class="fa-solid fa-heart"></i>
                        {% else %}
                            <i class="fa-regular fa-heart"></i>
                        {% endif %}
                    </a>  
                </div>

            </div>

        </div>
        {% empty %}
            <p class="text-center">No products found.</p>
        {% endfor %}
    </div>

</div>
{% endblock %}
