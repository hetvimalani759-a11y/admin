{% extends 'app/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/css/shop.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
{% endblock %}

{% block content %}
<input type="hidden" id="csrf-token" value="{{ csrf_token }}">

<div class="container py-4">
    <h2 class="text-center mb-4">üõç Shop Goggles</h2>

    <!-- Category Filter -->
    <div class="d-flex justify-content-center gap-2 mb-4 flex-wrap">
        <a href="{% url 'shop' %}" class="btn btn-outline-dark">All</a>
        {% for cat in categories %}
            <a href="?category={{ cat.name }}" class="btn btn-outline-dark">{{ cat.name }}</a>
        {% endfor %}
    </div>

    <!-- Products Grid -->
    <div class="product-grid">
        {% for product in products %}
        <div class="product-card">
            <a href="{% url 'product_detail' product.id %}" class="product-image">
                <img src="{{ product.image.url|default:'/static/app/images/default.png' }}" alt="{{ product.name }}">
            </a>
            <div class="product-body">
                <div class="product-rating">
                    <span class="rating">{{ product.rating|default:4.5 }} ‚òÖ</span>
                    <span class="reviews">({{ product.review_count|default:100 }})</span>
                </div>
                <div class="product-brand">{{ product.brand|default:"Brand Name" }}</div>
                <h5 class="product-name">{{ product.name }}</h5>
                <div class="price-row">
                    {% if product.get_offer %}
                    <span class="discounted-price">‚Çπ{{ product.get_final_price|floatformat:0 }}</span>
                    <span class="original-price">‚Çπ{{ product.price|floatformat:0 }}</span>
                    {% if product.get_offer.discount_type == "percent" %}
                        <span class="discount-text" style="color: green;">({{ product.get_offer.discount_value }}% OFF)</span>
                    {% else %}
                        <span class="discount-text" style="color: green;">(‚Çπ{{ product.get_offer.discount_value }} OFF)</span>
                    {% endif %}
                    {% else %}
                    <span class="discounted-price">‚Çπ{{ product.price|floatformat:0 }}</span>
                {% endif %}

                </div>

                <div class="card-actions d-flex gap-2 mt-2">
                    {% if product.stock > 0 %}
                        <button class="btn btn-primary btn-sm add-to-cart-btn" data-id="{{ product.id }}">
                            üõí Add to Cart
                        </button>
                    {% else %}
                        <button class="btn btn-secondary btn-sm" disabled>Out of Stock</button>
                    {% endif %}
                    <button class="btn btn-sm toggle-wishlist-btn" data-id="{{ product.id }}">
                        {% if product.id in wishlist_ids %}
                            <i class="fa-solid fa-heart"></i>
                        {% else %}
                            <i class="fa-regular fa-heart"></i>
                        {% endif %}
                    </button>
                </div>
            </div>
        </div>
        {% empty %}
            <p class="text-center">No products found.</p>
        {% endfor %}
    </div>
</div>

{% endblock %}
