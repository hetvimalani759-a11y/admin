{% extends 'app/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/css/cart.css' %}">
{% endblock %}

{% block content %}
<div class="cart-page">
    <h2 class="cart-title">ðŸ›’ My Cart</h2>

    {% if items %}
    <div class="cart-layout">

        <div class="cart-items">
            {% for item in items %}
            <div class="cart-row" id="cart-item-{{ item.id }}" data-id="{{ item.id }}">
                <div class="cart-img">
                    <img src="{{ item.product.image.url|default:'/static/app/images/default.png' }}">
                </div>

                <div class="cart-info">
                    <div class="cart-name">{{ item.product.name }}</div>
                    <div class="cart-price">
                        {% with offer=item.product.get_offer %}
                            {% if offer %}
                                <span class="discounted-price">â‚¹{{ item.product.get_final_price|floatformat:0 }}</span>
                                <span class="original-price">â‚¹{{ item.product.price|floatformat:0 }}</span>
                                {% if offer.discount_type == "percent" %}
                                    <span class="discount-text" style="color: green;">({{ offer.discount_value }}% OFF)</span>
                                {% else %}
                                    <span class="discount-text" style="color: green;">(â‚¹{{ offer.discount_value }} OFF)</span>
                                {% endif %}
                            {% else %}
                                <span class="discounted-price">â‚¹{{ item.product.price|floatformat:0 }}</span>
                            {% endif %}
                        {% endwith %}
                    </div>
                </div>

                <!-- QUANTITY -->
                <div class="qty-controls">
                    <button type="button" class="qty-btn minus-btn">âˆ’</button>
                    <span class="qty-number">{{ item.quantity }}</span>
                    <button type="button" class="qty-btn plus-btn">+</button>
                </div>

                <a href="{% url 'remove_from_cart' item.id %}" class="remove-btn">Remove</a>
            </div>
            {% endfor %}
        </div>

        <div class="cart-summary">
            <h5>Order Summary</h5>
            <div class="summary-row"><span>Items</span><span>{{ items|length }}</span></div>
            <div class="summary-row"><span>Original Total</span><span>â‚¹{{ original_total }}</span></div>
            <div class="summary-row discount-row"><span>Offer Discount</span><span>âˆ’ â‚¹{{ discount_total }}</span></div>
            <div class="summary-row"><span>Delivery</span><span>{% if delivery_charge == 0 %}Free ðŸŽ‰{% else %}â‚¹{{ delivery_charge }}{% endif %}</span></div>

            {% if total_saved > 0 %}
            <div class="saved-banner">ðŸŽ‰ You saved â‚¹{{ total_saved }}!</div>
            {% endif %}

            <div class="summary-row summary-total">
                <span>Total Payable</span>
                <span>â‚¹{{ grand_total }}</span>
            </div>

            <a href="{% url 'checkout' %}" class="checkout-btn btn btn-primary btn-lg w-100">Checkout</a>
            <div class="summary-actions">
                <a href="{% url 'shop' %}" class="add-more-link">âž• Add More Items</a>
            </div>
        </div>

    </div>
    {% else %}
    <div class="cart-empty">
        <p>Your cart is empty ðŸ˜”</p>
        <button class="btn-continue" onclick="window.location.href='{% url 'shop' %}'">Continue Shopping</button>
    </div>

    {% endif %}
</div>

<!-- âœ… CUSTOM CONFIRM MODAL -->
<div class="modal-overlay" id="confirm-modal">
    <div class="modal-box">
        <p id="confirm-text">Are you sure?</p>
        <div class="modal-actions">
            <button id="confirm-yes" class="modal-confirm">Yes</button>
            <button id="confirm-no" class="modal-cancel">No</button>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="{% static 'app/js/cart.js' %}"></script>
{% endblock %}
{% endblock %}
