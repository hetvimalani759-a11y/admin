{% extends "admin/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'admin/css/low_stock.css' %}">
{% endblock %}

{% block content %}
<div class="low-stock-page">
  <div class="low-stock-card">
    <h2 class="page-title ripple-text">📉 Low Stock Products</h2>

    <div class="content-grid">
      <!-- Table -->
      <div class="table-card">
        <table class="stock-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Product</th>
              <th>Stock</th>
            </tr>
          </thead>
          <tbody>
            {% for p in products %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ p.name }}</td>
              <td class="stock-low">{{ p.stock }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Chart -->
      <div class="chart-card">
        <canvas id="lowStockChart"></canvas>
      </div>
    </div>
  </div>
</div>

{{ labels|json_script:"lowStockLabels" }}
{{ data|json_script:"lowStockData" }}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const labels = JSON.parse(document.getElementById('lowStockLabels').textContent);
const values = JSON.parse(document.getElementById('lowStockData').textContent);

const ctx = document.getElementById('lowStockChart');
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      label: 'Stock Quantity',
      data: values,
      backgroundColor: 'rgba(220, 53, 69, 0.7)',
      borderRadius: 6
    }]
  },
  options: {
    animation: false,
    responsive: true,
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>
{% endblock %}
